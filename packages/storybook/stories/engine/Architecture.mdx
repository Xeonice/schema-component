import { Meta } from '@storybook/blocks'

<Meta title="Engine/Architecture" />

# Engine æ¶æ„æ–‡æ¡£

è¿™é‡ŒåŒ…å«äº† @schema-component/engine çš„å®Œæ•´æ¶æ„è®¾è®¡æ–‡æ¡£ã€‚

## ğŸ“š æ¶æ„è®¾è®¡

### æ¸²æŸ“ç³»ç»Ÿæ¶æ„

æ·±å…¥äº†è§£ Engine çš„æ¸²æŸ“ç³»ç»Ÿè®¾è®¡å’Œå®ç°åŸç†ï¼š

#### [Render Architecture](/docs/engine-docs-renderarchitecture)
**æ¸²æŸ“å±‚æ¶æ„è®¾è®¡ï¼ˆæœ€ç»ˆç‰ˆï¼‰**

æ ¸å¿ƒå†…å®¹ï¼š
- **æ¶æ„åŸåˆ™** - åˆ†å±‚èŒè´£å’Œæ ¸å¿ƒç†å¿µ
- **Engine å±‚** - Renderer æ¥å£å®šä¹‰ï¼ˆDataRendererã€ViewRendererã€ActionRendererï¼‰
- **çŠ¶æ€ç®¡ç†** - ViewStackã€ActionQueueã€RenderEngine
- **Framework å±‚** - React/Vue ç­‰æ¡†æ¶çš„å…·ä½“å®ç°
- **ä½¿ç”¨ç¤ºä¾‹** - å®Œæ•´çš„ä½¿ç”¨æµç¨‹å’Œä»£ç ç¤ºä¾‹

**é€‚åˆé˜…è¯»å¯¹è±¡**ï¼š
- æƒ³è¦ç†è§£æ•´ä½“æ¸²æŸ“æ¶æ„çš„å¼€å‘è€…
- éœ€è¦å®ç°è‡ªå®šä¹‰ Renderer çš„å¼€å‘è€…
- æ¡†æ¶é›†æˆå¼€å‘è€…

---

#### [Render Design](/docs/engine-docs-renderdesign)
**ä¸‰å±‚ Renderer æ¶æ„è®¾è®¡**

æ ¸å¿ƒå†…å®¹ï¼š
- **DataRenderer** - å­—æ®µçº§æ¸²æŸ“ï¼ŒåŸºäº Schema ç±»å‹
- **ViewRenderer** - è§†å›¾çº§æ¸²æŸ“ï¼ŒåŸºäº View ç±»å‹
- **ActionRenderer** - åŠ¨ä½œæ¸²æŸ“ï¼Œæ”¯æŒå¤šç§å±•ç¤ºæ¨¡å¼
- **å®Œæ•´å®ç°** - æ¯ä¸ª Renderer çš„è¯¦ç»†å®ç°ä»£ç 
- **ä½¿ç”¨ç¤ºä¾‹** - å®é™…ä½¿ç”¨åœºæ™¯å’Œä»£ç 

**é€‚åˆé˜…è¯»å¯¹è±¡**ï¼š
- éœ€è¦å®ç°å­—æ®µæ¸²æŸ“å™¨çš„å¼€å‘è€…
- éœ€è¦å®ç°è§†å›¾æ¸²æŸ“å™¨çš„å¼€å‘è€…
- éœ€è¦å®ç°åŠ¨ä½œæ¸²æŸ“å™¨çš„å¼€å‘è€…

---

#### [Render Layer Design](/docs/engine-docs-renderlayerdesign)
**æ¸²æŸ“åˆ†å±‚è®¾è®¡è¯¦è§£**

æ ¸å¿ƒå†…å®¹ï¼š
- **DataRenderer** - å­—æ®µçº§æ¸²æŸ“ï¼ˆæ”¯æŒ view/edit æ¨¡å¼ï¼‰
- **ViewRenderer** - è§†å›¾çº§æ¸²æŸ“ï¼ˆlist/form/detail/kanban ç­‰ï¼‰
- **ActionRenderer** - åŠ¨ä½œæ¸²æŸ“ + çŠ¶æ€ç®¡ç†ï¼ˆViewStack & ActionQueueï¼‰
- **RenderEngine** - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ Renderer
- **å®Œæ•´æµç¨‹** - ä»æ³¨å†Œåˆ°æ¸²æŸ“çš„å®Œæ•´æµç¨‹

**é€‚åˆé˜…è¯»å¯¹è±¡**ï¼š
- éœ€è¦æ·±å…¥ç†è§£åˆ†å±‚è®¾è®¡çš„å¼€å‘è€…
- éœ€è¦ç†è§£çŠ¶æ€ç®¡ç†çš„å¼€å‘è€…
- æ¶æ„è®¾è®¡è€…

---

#### [Action Renderer Design](/docs/engine-docs-actionrendererdesign)
**Action æ¸²æŸ“å™¨è®¾è®¡**

æ ¸å¿ƒå†…å®¹ï¼š
- **Action åˆ†ç±»** - ServerAction vs ViewAction
- **ç±»å‹å®šä¹‰** - å®Œæ•´çš„ TypeScript ç±»å‹ç³»ç»Ÿ
- **ServerActionRenderer** - åŸºç±»å®ç°å’Œæ‰©å±•
- **ViewActionRenderer** - å„ç§ View Action çš„å®ç°
- **ActionRendererRegistry** - ç»Ÿä¸€æ³¨å†Œç®¡ç†
- **ä½¿ç”¨ç¤ºä¾‹** - å®Œæ•´çš„ä½¿ç”¨åœºæ™¯

**é€‚åˆé˜…è¯»å¯¹è±¡**ï¼š
- éœ€è¦å®ç°è‡ªå®šä¹‰ Action Renderer çš„å¼€å‘è€…
- éœ€è¦ç†è§£ Action æ‰§è¡Œæµç¨‹çš„å¼€å‘è€…
- éœ€è¦æ‰©å±• Action åŠŸèƒ½çš„å¼€å‘è€…

---

## ğŸ” é˜…è¯»å»ºè®®

### å…¥é—¨é¡ºåº

å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ Engine çš„æ¸²æŸ“ç³»ç»Ÿï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºé˜…è¯»ï¼š

1. **[Overview](/docs/engine-overview)** - å…ˆäº†è§£æ•´ä½“æ¦‚è§ˆ
2. **[Getting Started](/docs/engine-getting-started)** - å¿«é€Ÿå…¥é—¨ï¼Œè¿è¡Œç¤ºä¾‹ä»£ç 
3. **[Render Architecture](/docs/engine-docs-renderarchitecture)** - ç†è§£æ•´ä½“æ¶æ„
4. **[Render Layer Design](/docs/engine-docs-renderlayerdesign)** - æ·±å…¥åˆ†å±‚è®¾è®¡
5. **[Render Design](/docs/engine-docs-renderdesign)** - äº†è§£ä¸‰å±‚ Renderer
6. **[Action Renderer Design](/docs/engine-docs-actionrendererdesign)** - ä¸“æ³¨ Action å®ç°

### æŒ‰éœ€æŸ¥é˜…

å¦‚æœä½ å·²ç»ç†Ÿæ‚‰åŸºç¡€æ¦‚å¿µï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚ç›´æ¥æŸ¥é˜…ï¼š

**å®ç°å­—æ®µæ¸²æŸ“å™¨**
â†’ [Render Design](/docs/engine-docs-renderdesign) (DataRenderer éƒ¨åˆ†)

**å®ç°è§†å›¾æ¸²æŸ“å™¨**
â†’ [Render Design](/docs/engine-docs-renderdesign) (ViewRenderer éƒ¨åˆ†)

**å®ç°åŠ¨ä½œæ¸²æŸ“å™¨**
â†’ [Action Renderer Design](/docs/engine-docs-actionrendererdesign)

**ç†è§£çŠ¶æ€ç®¡ç†**
â†’ [Render Layer Design](/docs/engine-docs-renderlayerdesign) (ActionRenderer éƒ¨åˆ†)

**æ¡†æ¶é›†æˆ**
â†’ [Render Architecture](/docs/engine-docs-renderarchitecture) (Framework å±‚éƒ¨åˆ†)

---

## ğŸ—ï¸ æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Framework Layer (React/Vue/...)                        â”‚
â”‚  - å…·ä½“çš„ UI ç»„ä»¶å®ç°                                    â”‚
â”‚  - å…·ä½“çš„ Renderer å®ç°                                  â”‚
â”‚  - æ¡†æ¶ç‰¹å®šçš„çŠ¶æ€ç»‘å®š                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†‘
                          â”‚ å®ç°æ¥å£
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Engine Layer (@schema-component/engine)                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ DataRenderer   â”‚  â”‚ ViewRenderer   â”‚               â”‚
â”‚  â”‚   Interface    â”‚  â”‚   Interface    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ActionRenderer â”‚  â”‚  RenderEngine  â”‚               â”‚
â”‚  â”‚   Interface    â”‚  â”‚   (Registry)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   ViewStack    â”‚  â”‚  ActionQueue   â”‚               â”‚
â”‚  â”‚ (State Mgmt)   â”‚  â”‚ (State Mgmt)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†‘
                          â”‚ ä½¿ç”¨
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Layer (defineModel)                              â”‚
â”‚  - Schema å®šä¹‰                                          â”‚
â”‚  - Views å®šä¹‰                                           â”‚
â”‚  - Actions å®šä¹‰                                         â”‚
â”‚  - APIs å®šä¹‰                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. æ¡†æ¶æ— å…³

Engine å±‚åªå®šä¹‰æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“æ¡†æ¶ï¼š
- âœ“ å¯ä»¥é›†æˆ React
- âœ“ å¯ä»¥é›†æˆ Vue
- âœ“ å¯ä»¥é›†æˆä»»ä½•å…¶ä»– UI æ¡†æ¶
- âœ“ ç”šè‡³å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“

### 2. åˆ†å±‚æ¸…æ™°

ä¸‰å±‚ Renderer å„å¸å…¶èŒï¼š
- **DataRenderer** - æœ€ç»†ç²’åº¦ï¼Œæ¸²æŸ“å•ä¸ªå­—æ®µ
- **ViewRenderer** - ä¸­é—´å±‚ï¼Œæ¸²æŸ“æ•´ä¸ªè§†å›¾
- **ActionRenderer** - æœ€é«˜å±‚ï¼Œæ¸²æŸ“å’Œæ‰§è¡ŒåŠ¨ä½œ

### 3. çŠ¶æ€é›†ä¸­

æ‰€æœ‰çŠ¶æ€ç”± Engine å±‚ç»Ÿä¸€ç®¡ç†ï¼š
- **ViewStack** - è§†å›¾æ ˆï¼Œç®¡ç†å¯¼èˆªå†å²
- **ActionQueue** - åŠ¨ä½œé˜Ÿåˆ—ï¼Œç®¡ç†å¼‚æ­¥ä»»åŠ¡
- **RenderEngine** - æ¸²æŸ“å¼•æ“ï¼Œç»Ÿä¸€æ³¨å†Œå’Œè°ƒåº¦

### 4. å¯æ‰©å±•

çµæ´»çš„æ‰©å±•ç‚¹ï¼š
- è‡ªå®šä¹‰ DataRenderer
- è‡ªå®šä¹‰ ViewRenderer
- è‡ªå®šä¹‰ ActionRenderer
- è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†ç­–ç•¥

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [Core Module](/docs/engine-core-overview) - æ ¸å¿ƒæ¨¡å‹ç³»ç»Ÿ
- [DI Module](/docs/engine-di-overview) - ä¾èµ–æ³¨å…¥
- [Event Module](/docs/engine-event-overview) - äº‹ä»¶ç³»ç»Ÿ
- [State Module](/docs/engine-state-overview) - çŠ¶æ€ç®¡ç†
- [Repository Module](/docs/engine-repository-overview) - æ•°æ®è®¿é—®å±‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥

é˜…è¯»å®Œæ¶æ„æ–‡æ¡£åï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹äº¤äº’å¼ç¤ºä¾‹** - æµè§ˆå·¦ä¾§å¯¼èˆªçš„å„ä¸ªæ¨¡å— Stories
2. **è¿è¡Œç¤ºä¾‹ä»£ç ** - æŸ¥çœ‹ `packages/engine/examples/` ç›®å½•
3. **é˜…è¯» API æ–‡æ¡£** - äº†è§£è¯¦ç»†çš„ API ä½¿ç”¨æ–¹æ³•
4. **å¼€å§‹å®è·µ** - åŸºäº Engine æ„å»ºä½ çš„åº”ç”¨

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ [GitHub Issues](https://github.com/Xeonice/schema-component/issues) æäº¤åé¦ˆã€‚
