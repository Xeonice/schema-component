import { Meta } from '@storybook/blocks'

<Meta title="Engine/Architecture" />

# Engine 架构文档

这里包含了 @schema-component/engine 的完整架构设计文档。

## 📚 架构设计

### 渲染系统架构

深入了解 Engine 的渲染系统设计和实现原理：

#### [Render Architecture](/docs/engine-docs-renderarchitecture)
**渲染层架构设计（最终版）**

核心内容：
- **架构原则** - 分层职责和核心理念
- **Engine 层** - Renderer 接口定义（DataRenderer、ViewRenderer、ActionRenderer）
- **状态管理** - ViewStack、ActionQueue、RenderEngine
- **Framework 层** - React/Vue 等框架的具体实现
- **使用示例** - 完整的使用流程和代码示例

**适合阅读对象**：
- 想要理解整体渲染架构的开发者
- 需要实现自定义 Renderer 的开发者
- 框架集成开发者

---

#### [Render Design](/docs/engine-docs-renderdesign)
**三层 Renderer 架构设计**

核心内容：
- **DataRenderer** - 字段级渲染，基于 Schema 类型
- **ViewRenderer** - 视图级渲染，基于 View 类型
- **ActionRenderer** - 动作渲染，支持多种展示模式
- **完整实现** - 每个 Renderer 的详细实现代码
- **使用示例** - 实际使用场景和代码

**适合阅读对象**：
- 需要实现字段渲染器的开发者
- 需要实现视图渲染器的开发者
- 需要实现动作渲染器的开发者

---

#### [Render Layer Design](/docs/engine-docs-renderlayerdesign)
**渲染分层设计详解**

核心内容：
- **DataRenderer** - 字段级渲染（支持 view/edit 模式）
- **ViewRenderer** - 视图级渲染（list/form/detail/kanban 等）
- **ActionRenderer** - 动作渲染 + 状态管理（ViewStack & ActionQueue）
- **RenderEngine** - 统一管理所有 Renderer
- **完整流程** - 从注册到渲染的完整流程

**适合阅读对象**：
- 需要深入理解分层设计的开发者
- 需要理解状态管理的开发者
- 架构设计者

---

#### [Action Renderer Design](/docs/engine-docs-actionrendererdesign)
**Action 渲染器设计**

核心内容：
- **Action 分类** - ServerAction vs ViewAction
- **类型定义** - 完整的 TypeScript 类型系统
- **ServerActionRenderer** - 基类实现和扩展
- **ViewActionRenderer** - 各种 View Action 的实现
- **ActionRendererRegistry** - 统一注册管理
- **使用示例** - 完整的使用场景

**适合阅读对象**：
- 需要实现自定义 Action Renderer 的开发者
- 需要理解 Action 执行流程的开发者
- 需要扩展 Action 功能的开发者

---

## 🔍 阅读建议

### 入门顺序

如果你是第一次接触 Engine 的渲染系统，建议按照以下顺序阅读：

1. **[Overview](/docs/engine-overview)** - 先了解整体概览
2. **[Getting Started](/docs/engine-getting-started)** - 快速入门，运行示例代码
3. **[Render Architecture](/docs/engine-docs-renderarchitecture)** - 理解整体架构
4. **[Render Layer Design](/docs/engine-docs-renderlayerdesign)** - 深入分层设计
5. **[Render Design](/docs/engine-docs-renderdesign)** - 了解三层 Renderer
6. **[Action Renderer Design](/docs/engine-docs-actionrendererdesign)** - 专注 Action 实现

### 按需查阅

如果你已经熟悉基础概念，可以根据具体需求直接查阅：

**实现字段渲染器**
→ [Render Design](/docs/engine-docs-renderdesign) (DataRenderer 部分)

**实现视图渲染器**
→ [Render Design](/docs/engine-docs-renderdesign) (ViewRenderer 部分)

**实现动作渲染器**
→ [Action Renderer Design](/docs/engine-docs-actionrendererdesign)

**理解状态管理**
→ [Render Layer Design](/docs/engine-docs-renderlayerdesign) (ActionRenderer 部分)

**框架集成**
→ [Render Architecture](/docs/engine-docs-renderarchitecture) (Framework 层部分)

---

## 🏗️ 架构总览

```
┌─────────────────────────────────────────────────────────┐
│  Framework Layer (React/Vue/...)                        │
│  - 具体的 UI 组件实现                                    │
│  - 具体的 Renderer 实现                                  │
│  - 框架特定的状态绑定                                    │
└─────────────────────────────────────────────────────────┘
                          ↑
                          │ 实现接口
                          │
┌─────────────────────────────────────────────────────────┐
│  Engine Layer (@schema-component/engine)                │
│                                                         │
│  ┌────────────────┐  ┌────────────────┐               │
│  │ DataRenderer   │  │ ViewRenderer   │               │
│  │   Interface    │  │   Interface    │               │
│  └────────────────┘  └────────────────┘               │
│                                                         │
│  ┌────────────────┐  ┌────────────────┐               │
│  │ ActionRenderer │  │  RenderEngine  │               │
│  │   Interface    │  │   (Registry)   │               │
│  └────────────────┘  └────────────────┘               │
│                                                         │
│  ┌────────────────┐  ┌────────────────┐               │
│  │   ViewStack    │  │  ActionQueue   │               │
│  │ (State Mgmt)   │  │ (State Mgmt)   │               │
│  └────────────────┘  └────────────────┘               │
└─────────────────────────────────────────────────────────┘
                          ↑
                          │ 使用
                          │
┌─────────────────────────────────────────────────────────┐
│  Model Layer (defineModel)                              │
│  - Schema 定义                                          │
│  - Views 定义                                           │
│  - Actions 定义                                         │
│  - APIs 定义                                            │
└─────────────────────────────────────────────────────────┘
```

---

## 💡 核心设计理念

### 1. 框架无关

Engine 层只定义接口，不依赖具体框架：
- ✓ 可以集成 React
- ✓ 可以集成 Vue
- ✓ 可以集成任何其他 UI 框架
- ✓ 甚至可以在服务端渲染

### 2. 分层清晰

三层 Renderer 各司其职：
- **DataRenderer** - 最细粒度，渲染单个字段
- **ViewRenderer** - 中间层，渲染整个视图
- **ActionRenderer** - 最高层，渲染和执行动作

### 3. 状态集中

所有状态由 Engine 层统一管理：
- **ViewStack** - 视图栈，管理导航历史
- **ActionQueue** - 动作队列，管理异步任务
- **RenderEngine** - 渲染引擎，统一注册和调度

### 4. 可扩展

灵活的扩展点：
- 自定义 DataRenderer
- 自定义 ViewRenderer
- 自定义 ActionRenderer
- 自定义状态管理策略

---

## 🔗 相关链接

- [Core Module](/docs/engine-core-overview) - 核心模型系统
- [DI Module](/docs/engine-di-overview) - 依赖注入
- [Event Module](/docs/engine-event-overview) - 事件系统
- [State Module](/docs/engine-state-overview) - 状态管理
- [Repository Module](/docs/engine-repository-overview) - 数据访问层

---

## 🎯 下一步

阅读完架构文档后，可以：

1. **查看交互式示例** - 浏览左侧导航的各个模块 Stories
2. **运行示例代码** - 查看 `packages/engine/examples/` 目录
3. **阅读 API 文档** - 了解详细的 API 使用方法
4. **开始实践** - 基于 Engine 构建你的应用

如有问题或建议，欢迎在 [GitHub Issues](https://github.com/Xeonice/schema-component/issues) 提交反馈。
